# Домашнее задание к занятию "3.2. Работа в терминале, лекция 2"

1. Какого типа команда `cd`? Попробуйте объяснить, почему она именно такого типа; опишите ход своих мыслей, если
   считаете что она могла бы быть другого типа.

> Ответ:  type cd cd is a shell builtin

2. Какая альтернатива без pipe команде `grep <some_string> <some_file> | wc -l`? `man grep` поможет в ответе на этот
   вопрос. Ознакомьтесь с [документом](http://www.smallo.ruhr.de/award.html) о других подобных некорректных вариантах
   использования pipe.

> Ответ: grep -c <some_string> <some_file>

3. Какой процесс с PID `1` является родителем для всех процессов в вашей виртуальной машине Ubuntu 20.04?

> Ответ:  ps -p 1
> systemd
> systemd(1)─┬─VBoxService(822)─┬─{VBoxService}(824)
│ ├─{VBoxService}(825)
│ ├─{VBoxService}(826)
│ ├─{VBoxService}(827)
│ ├─{VBoxService}(828)
│ ├─{VBoxService}(829)
│ ├─{VBoxService}(830)
│ └─{VBoxService}(831)
├─accounts-daemon(609)─┬─{accounts-daemon}(633)
│ └─{accounts-daemon}(666)
├─agetty(857)
├─atd(846)
├─cron(844)
├─dbus-daemon(611)
├─irqbalance(623)───{irqbalance}(639)
├─multipathd(559)─┬─{multipathd}(560)
│ ├─{multipathd}(561)
│ ├─{multipathd}(562)
│ ├─{multipathd}(563)
│ ├─{multipathd}(564)
│ └─{multipathd}(565)
├─networkd-dispat(628)
├─polkitd(692)─┬─{polkitd}(693)
│ └─{polkitd}(695)
├─rpcbind(586)
├─rsyslogd(629)─┬─{rsyslogd}(652)
│ ├─{rsyslogd}(653)
│ └─{rsyslogd}(654)
├─sshd(856)───sshd(1160)───sshd(1213)───bash(1214)───pstree(1252)
├─systemd(1174)───(sd-pam)(1177)
├─systemd-journal(385)
├─systemd-logind(645)
├─systemd-network(421)
├─systemd-resolve(587)
└─systemd-udevd(414)

4. Как будет выглядеть команда, которая перенаправит вывод stderr `ls` на другую сессию терминала?
> Ответ: ls /tttt 2>/dev/pts/2

5. Получится ли одновременно передать команде файл на stdin и вывести ее stdout в другой файл? Приведите работающий
   пример.
> Ответ: cat >1.txt
first line
second line;
cat 1.txt
first line
second line;
cat <1.txt >2.txt
cat 2.txt
first line
second line;

6. Получится ли находясь в графическом режиме, вывести данные из PTY в какой-либо из эмуляторов TTY? Сможете ли вы
   наблюдать выводимые данные?
   > Ответ: Да, получится. Данные вывода содержимого директории /home, отправленные из графического терминала /dev/pts/0 могу наблюдать в эмуляторе терминала /dev/tty3:
   > ``` 
   > $ ls /home > /dev/tty3 ```

7. Выполните команду `bash 5>&1`. К чему она приведет? Что будет, если вы выполните `echo netology > /proc/$$/fd/5`?
   Почему так происходит?
> Ответ: команда `bash 5>&1` создает новый поток bash с дескриптором № 5 и перенаправляет его на стандартный поток вывода с дескриптором № 1. А дальнейшая команда `echo netology > /proc/$$/fd/5` перенаправляет выходной поток команды echo на 5-й дескриптор процесса bash, который мы создали и перенаправили предыдущей командой. Т.е. фактически мы выводим слово netology на экран транзитом через перенаправленный на стандартный вывод 5-й поток. Поэтому и видим слово netology как результат работы команды `echo netology > /proc/$$/fd/5`.

8. Получится ли в качестве входного потока для pipe использовать только stderr команды, не потеряв при этом отображение
   stdout на pty? Напоминаем: по умолчанию через pipe передается только stdout команды слева от `|` на stdin команды
   справа. Это можно сделать, поменяв стандартные потоки местами через промежуточный новый дескриптор, который вы
   научились создавать в предыдущем вопросе> Ответ: dir /123123 6>&2 2>&1 1>&6 | grep such

9. Что выведет команда `cat /proc/$$/environ`? Как еще можно получить аналогичный по содержанию вывод?

> Ответ:
> Этот файл содержит переменные окружения процесса. Аналогичный вывод можно сделать командой `env`. Эта команда покажет большее количество переменных окружения.

10. Используя `man`, опишите что доступно по адресам `/proc/<PID>/cmdline`, `/proc/<PID>/exe`.

> Ответ:
> /proc/<PID>/cmdline - Этот файл содержит полную командную строку запуска процесса, кроме тех процессов, что полностью ушли в своппинг, а также тех, что превратились в зомби.
> /proc/<PID>/exe - является символьной ссылкой, содержащей фактическое полное имя выполняемого файла
>

11. Узнайте, какую наиболее старшую версию набора инструкций SSE поддерживает ваш процессор с помощью `/proc/cpuinfo`.

> Ответ: cat /proc/cpuinfo Ответ в flags
> sse4_2

12. При открытии нового окна терминала и `vagrant ssh` создается новая сессия и выделяется pty. Это можно подтвердить
    командой `tty`, которая упоминалась в лекции 3.2. Однако:

    ```shell position-relative overflow-auto
    vagrant@netology1:~$ ssh localhost 'tty'
    not a tty
    ```
    Почитайте, почему так происходит, и как изменить поведение.
> Ответ: Предполагаю, что подключиться "к самомму себе" ssh не может. При использовании ключа -t ssh принудительно создаться псевдотерминал.

13. Бывает, что есть необходимость переместить запущенный процесс из одной сессии в другую. Попробуйте сделать это,
    воспользовавшись `reptyr`. Например, так можно перенести в `screen` процесс, который вы запустили по ошибке в
    обычной SSH-сессии.
> Ответ: Установка reptyr: sudo apt-get install reptyr
> Для теста перенаправления установил midnight commander
> В сессии ssh запусти midnight commander: mc.
> Зашел в сессию tty через интерфейс Virtual Box
>  Нашел pid процесса mc:
ps aux | grep mc
> Выполнил команду reptyr 1152 - на экране отобразился интерфейс midnight commander

14. `sudo echo string > /root/new_file` не даст выполнить перенаправление под обычным пользователем, так как
    перенаправлением занимается процесс shell'а, который запущен без `sudo` под вашим пользователем. Для решения данной
    проблемы можно использовать конструкцию `echo string | sudo tee /root/new_file`. Узнайте что делает команда `tee` и
    почему в отличие от `sudo echo` команда с `sudo tee` будет работать.

> Ответ: Команда tee в Linux считывает стандартный ввод и записывает его одновременно в стандартный вывод и в один или несколько подготовленных файлов
> Bash запущен под обычным пользователем, поэтому для вывода не хватает разрешений.
